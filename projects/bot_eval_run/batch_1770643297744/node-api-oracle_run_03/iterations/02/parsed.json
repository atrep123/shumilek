{
  "mode": "patch",
  "files": [
    {
      "path": "package.json",
      "content": "{\n  \"name\": \"todo-api\",\n  \"version\": \"1.0.0\",\n  \"type\": \"commonjs\"\n}"
    },
    {
      "path": "src/server.js",
      "content": "const http = require('node:http');\nconst crypto = require('node:crypto');\nconst fs = require('node:fs');\nconst path = require('node:path');\n\nmodule.exports.createServer = ({ dataPath }) => {\n  const todos = [];\n\n  return http.createServer((req, res) => {\n    if (req.method === 'GET' && req.url === '/health') {\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true }));\n    } else if (req.method === 'GET' && req.url === '/openapi.json') {\n      const spec = {\n        openapi: '3.0.0',\n        paths: { '/todos': {} }\n      };\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify(spec));\n    } else if (req.method === 'GET' && req.url.startsWith('/todos')) {\n      const id = req.url.split('/').pop();\n      const todo = todos.find(t => t.id === id);\n      if (!todo) {\n        res.writeHead(404, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n      } else {\n        res.writeHead(200, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true, todo }));\n      }\n    } else if (req.method === 'POST' && req.url === '/todos') {\n      let body = '';\n      req.on('data', chunk => { body += chunk.toString(); });\n      req.on('end', () => {\n        const data = JSON.parse(body);\n        const todo = { id: crypto.randomUUID(), title: data.title, done: false, createdAt: new Date().toISOString() };\n        todos.push(todo);\n        fs.writeFileSync(dataPath, JSON.stringify({ todos }));\n        res.writeHead(201, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true, todo }));\n      });\n    } else if (req.method === 'PATCH' && req.url.startsWith('/todos')) {\n      let body = '';\n      req.on('data', chunk => { body += chunk.toString(); });\n      req.on('end', () => {\n        const data = JSON.parse(body);\n        const id = req.url.split('/').pop();\n        const todoIndex = todos.findIndex(t => t.id === id);\n        if (todoIndex === -1) {\n          res.writeHead(404, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n        } else {\n          const todo = todos[todoIndex];\n          if (data.done !== undefined) {\n            todo.done = data.done;\n            if (todo.done) {\n              todo.doneAt = new Date().toISOString();\n            }\n          }\n          fs.writeFileSync(dataPath, JSON.stringify({ todos }));\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo }));\n        }\n      });\n    } else {\n      res.writeHead(404, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: false, error: 'Not found' }));\n    }\n  }).listen(8080);\n};\n"
    },
    {
      "path": "openapi.json",
      "content": "{\n  \"openapi\": \"3.0.0\",\n  \"paths\": {\n    \"/todos\": {}\n  }\n}"
    }
  ],
  "notes": "optional"
}