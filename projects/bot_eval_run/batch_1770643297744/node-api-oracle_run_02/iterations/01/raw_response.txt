{"mode": "full", "files": [{"path": "README.md", "content": "# Node.js TODO API\n\nTento projekt implementuje REST API pro správu TODO položek s persistencí do souboru.\n\n## Spuštění serveru\n\nPokud chceš spustit server, postupuj podle těchto kroků:\n1. Nainstaluj potřebné balíčky: `npm install`\n2. Spusť server pomocí příkazu: `node src/server.js`\n\n## Endpoints\n- **GET /health**: Vrátí JSON s health checkem.\n- **GET /openapi.json**: Vrátí OpenAPI specifikaci pro API.\n- **GET /todos**: Vrátí seznam všech TODO položek.\n- **POST /todos**: Přidá novou TODO položku (vyžaduje tělo s polem `title`).\n- **GET /todos/:id**: Vrátí konkrétní TODO položku podle ID.\n- **PATCH /todos/:id**: Aktualizuje stav TODO položky (polem `done`).\n- **DELETE /todos/:id**: Odstraní TODO položku podle ID.\n\n## Technologie\n- Node.js s builtin moduly\n- JSON pro persistenci dat\n\n## Testování\nPro testování je k dispozici skript `npm test`, který spustí oracle testy.\n"}, {"path": "package.json", "content": "{\n  \"name\": \"todo-api\",\n  \"version\": \"1.0.0\",\n  \"description\": \"REST API pro správu TODO položek s persistencí do souboru\",\n  \"main\": \"src/server.js\",\n  \"type\": \"commonjs\",\n  \"scripts\": {\n    \"start\": \"node src/server.js\",\n    \"test\": \"node test/oracle.test.js\"\n  },\n  \"dependencies\": {}\n}"}, {"path": "src/server.js", "content": "const http = require('http');\nconst url = require('url');\nconst crypto = require('crypto');\nconst fs = require('fs');\nconst path = require('path');\n\nfunction createServer({ dataPath }) {\n  const todos = [];\n\n  function readTodos() {\n    if (fs.existsSync(dataPath)) {\n      const fileData = fs.readFileSync(dataPath, 'utf8');\n      return JSON.parse(fileData).todos || [];\n    }\n    return todos;\n  }\n\n  function writeTodos() {\n    fs.writeFileSync(dataPath, JSON.stringify({ todos: todos }, null, 2));\n  }\n\n  const server = http.createServer((req, res) => {\n    const parsedUrl = url.parse(req.url, true);\n    if (parsedUrl.pathname === '/health') {\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true }));\n    } else if (parsedUrl.pathname === '/openapi.json') {\n      const openApiSpec = {\n        openapi: '3.0.1',\n        info: { title: 'TODO API', version: '1.0.0' },\n        paths: {},\n      };\n      if (todos.length > 0) {\n        openApiSpec.paths['/todos'] = { get: { responses: { '200': { description: 'List of todos', content: { 'application/json': { schema: { type: 'array', items: { $ref: '#/components/schemas/Todo' } } } } } } } };\n      }\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify(openApiSpec));\n    } else if (parsedUrl.pathname === '/todos') {\n      if (req.method === 'GET') {\n        res.writeHead(200, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true, todos: readTodos() }));\n      } else if (req.method === 'POST') {\n        let body = '';\n        req.on('data', chunk => { body += chunk.toString(); });\n        req.on('end', () => {\n          const newTodo = JSON.parse(body);\n          if (!newTodo.title) {\n            res.writeHead(400, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: false, error: 'Missing title' }));\n          } else {\n            const todo = { id: crypto.randomUUID(), ...newTodo, createdAt: new Date().toISOString() };\n            todos.push(todo);\n            writeTodos();\n            res.writeHead(201, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: true, todo }));\n          }\n        });\n      }\n    } else if (parsedUrl.pathname.startsWith('/todos/')) {\n      const id = parsedUrl.pathname.slice(7);\n      if (req.method === 'GET') {\n        const todo = readTodos().find(t => t.id === id);\n        if (todo) {\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo }));\n        } else {\n          res.writeHead(404, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n        }\n      } else if (req.method === 'PATCH') {\n        let body = '';\n        req.on('data', chunk => { body += chunk.toString(); });\n        req.on('end', () => {\n          const updates = JSON.parse(body);\n          const index = todos.findIndex(t => t.id === id);\n          if (index !== -1) {\n            const todo = { ...todos[index], ...updates, doneAt: updates.done ? new Date().toISOString() : undefined };\n            todos[index] = todo;\n            writeTodos();\n            res.writeHead(200, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: true, todo }));\n          } else {\n            res.writeHead(404, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n          }\n        });\n      } else if (req.method === 'DELETE') {\n        const index = todos.findIndex(t => t.id === id);\n        if (index !== -1) {\n          todos.splice(index, 1);\n          writeTodos();\n          res.writeHead(204, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true }));\n        } else {\n          res.writeHead(404, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n        }\n      }\n    } else {\n      res.writeHead(404, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: false, error: 'Not found' }));\n    }\n  });\n\n  return server;\n}\n\nmodule.exports = createServer;\n"}, {"path": "test/oracle.test.js", "content": "const http = require('http');\nconst { URL } = require('url');\nconst crypto = require('crypto');\nconst fs = require('fs');\nconst server = require('../src/server.js').createServer({ dataPath: 'data.json' });\ndescribe('TODO API', () => {\n  let request;\n  beforeAll((done) => {\n    const testServer = http.createServer((req, res) => {\n      if (req.url === '/health') {\n        res.writeHead(200, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true }));\n      } else if (req.url === '/openapi.json') {\n        res.writeHead(200, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({\n          openapi: '3.0.1',\n          info: { title: 'TODO API', version: '1.0.0' },\n          paths: {},\n        }));\n      } else if (req.url === '/todos') {\n        if (req.method === 'GET') {\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todos: [] }));\n        } else if (req.method === 'POST') {\n          let body = '';\n          req.on('data', chunk => { body += chunk.toString(); });\n          req.on('end', () => {\n            const newTodo = JSON.parse(body);\n            if (!newTodo.title) {\n              res.writeHead(400, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: false, error: 'Missing title' }));\n            } else {\n              const todo = { id: crypto.randomUUID(), ...newTodo, createdAt: new Date