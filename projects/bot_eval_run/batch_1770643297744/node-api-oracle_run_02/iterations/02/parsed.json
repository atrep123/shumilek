{
  "mode": "patch",
  "files": [
    {
      "path": "package.json",
      "content": "{\n  \"name\": \"todo-api\",\n  \"version\": \"1.0.0\",\n  \"type\": \"commonjs\"\n}"
    },
    {
      "path": "src/server.js",
      "content": "const http = require('node:http');\nconst url = require('node:url');\nconst crypto = require('node:crypto');\nconst fs = require('node:fs');\nconst path = require('node:path');\n\nmodule.exports.createServer = ({ dataPath }) => {\n  const todos = [];\n\n  return http.createServer((req, res) => {\n    const parsedUrl = url.parse(req.url, true);\n    if (parsedUrl.pathname === '/health') {\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true }));\n    } else if (parsedUrl.pathname === '/openapi.json') {\n      const openapiSpec = {\n        openapi: '3.0.0',\n        info: { title: 'Todo API', version: '1.0.0' },\n        paths: {}\n      };\n      if (!fs.existsSync(dataPath)) fs.writeFileSync(dataPath, JSON.stringify({ todos: [] }));\n      openapiSpec.paths['/todos'] = {\n        get: { summary: 'Get all todos', responses: { 200: { description: 'List of todos', content: { 'application/json': { schema: { type: 'array', items: { $ref: '#/components/schemas/Todo' } } } } }\n},\npost: { summary: 'Create a new todo', requestBody: { content: { 'application/json': { schema: { $ref: '#/components/schemas/TodoInput' } } } }, responses: { 201: { description: 'Created todo', content: { 'application/json': { schema: { $ref: '#/components/schemas/Todo' } } } }\n}\n}\n}\n};\n\nres.writeHead(200, { 'Content-Type': 'application/json' });\nres.end(JSON.stringify(openapiSpec));\n} else if (parsedUrl.pathname === '/todos') {\n  if (req.method === 'GET') {\n    res.writeHead(200, { 'Content-Type': 'application/json' });\n    res.end(JSON.stringify({ ok: true, todos }));\n  } else if (req.method === 'POST') {\n    let body = '';\n    req.on('data', chunk => { body += chunk.toString(); });\n    req.on('end', () => {\n      const todoInput = JSON.parse(body);\n      const newTodo = { id: crypto.randomUUID(), ...todoInput, createdAt: new Date().toISOString() };\n      todos.push(newTodo);\n      fs.writeFileSync(dataPath, JSON.stringify({ todos }));\n      res.writeHead(201, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true, todo: newTodo }));\n    });\n  }\n} else if (parsedUrl.pathname.match(/^/todos/[a-f0-9]+$/i)) {\n  const id = parsedUrl.pathname.split('/').pop();\n  if (req.method === 'GET') {\n    const todo = todos.find(t => t.id === id);\n    if (todo) {\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true, todo }));\n    } else {\n      res.writeHead(404, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: false }));\n    }\n  } else if (req.method === 'PUT' || req.method === 'PATCH') {\n    // Not implemented\n  } else if (req.method === 'DELETE') {\n    const index = todos.findIndex(t => t.id === id);\n    if (index !== -1) {\n      todos.splice(index, 1);\n      fs.writeFileSync(dataPath, JSON.stringify({ todos }));\n      res.writeHead(204, { 'Content-Type': 'application/json' });\n      res.end();\n    } else {\n      res.writeHead(404, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: false }));\n    }\n  }\n} else {\n  res.writeHead(404, { 'Content-Type': 'application/json' });\n  res.end(JSON.stringify({ ok: false }));\n}\n}).listen(8080);\n};"
    }
  ],
  "notes": "optional"
}