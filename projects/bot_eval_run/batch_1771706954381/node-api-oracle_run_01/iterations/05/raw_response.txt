{
  "files": [
    {
      "path": "src/server.js",
      "content": "// Import necessary modules\nconst http = require('http');\nconst fs = require('fs');\nconst path = require('path');\n\n// Function to handle requests\nfunction requestHandler(req, res) {\n  const url = req.url;\n  const method = req.method;\n\n  // Handle GET /health\n  if (url === '/health' && method === 'GET') {\n    res.writeHead(200, { 'Content-Type': 'application/json' });\n    res.end(JSON.stringify({ status: 'healthy' }));\n    return;\n  }\n\n  // Handle GET /todos\n  if (url === '/todos' && method === 'GET') {\n    const todos = JSON.parse(fs.readFileSync('data/todos.json', 'utf8')) || [];\n    res.writeHead(200, { 'Content-Type': 'application/json' });\n    res.end(JSON.stringify({ ok: true, todos }));\n    return;\n  }\n\n  // Handle POST /todos\n  if (url === '/todos' && method === 'POST') {\n    let body = '';\n    req.on('data', chunk => {\n      body += chunk.toString();\n    });\n    req.on('end', () => {\n      const todo = JSON.parse(body);\n      const todos = JSON.parse(fs.readFileSync('data/todos.json', 'utf8')) || [];\n      todo.id = Date.now().toString();\n      todo.createdAt = new Date().toISOString();\n      todos.push(todo);\n      fs.writeFileSync('data/todos.json', JSON.stringify(todos, null, 2));\n      res.writeHead(201, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true, todo }));\n    });\n    return;\n  }\n\n  // Handle GET /todos/:id\n  if (url.startsWith('/todos/') && method === 'GET') {\n    const id = url.split('/')[2];\n    const todos = JSON.parse(fs.readFileSync('data/todos.json', 'utf8')) || [];\n    const todo = todos.find(t => t.id === id);\n    if (todo) {\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true, todo }));\n    } else {\n      res.writeHead(404, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: false, error: 'TODO item not found' }));\n    }\n    return;\n  }\n\n  // Handle PATCH /todos/:id\n  if (url.startsWith('/todos/') && method === 'PATCH') {\n    let body = '';\n    req.on('data', chunk => {\n      body += chunk.toString();\n    });\n    req.on('end', () => {\n      const update = JSON.parse(body);\n      const id = url.split('/')[2];\n      const todos = JSON.parse(fs.readFileSync('data/todos.json', 'utf8')) || [];\n      const todoIndex = todos.findIndex(t => t.id === id);\n      if (todoIndex !== -1) {\n        todos[todoIndex].done = update.done;\n        if (update.done) {\n          todos[todoIndex].doneAt = new Date().toISOString();\n        }\n        fs.writeFileSync('data/todos.json', JSON.stringify(todos, null, 2));\n        res.writeHead(200, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true, todo: todos[todoIndex] }));\n      } else {\n        res.writeHead(404, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'TODO item not found' }));\n      }\n    });\n    return;\n  }\n\n  // Handle DELETE /todos/:id\n  if (url.startsWith('/todos/') && method === 'DELETE') {\n    const id = url.split('/')[2];\n    let todos = JSON.parse(fs.readFileSync('data/todos.json', 'utf8')) || [];\n    todos = todos.filter(t => t.id !== id);\n    fs.writeFileSync('data/todos.json', JSON.stringify(todos, null, 2));\n    res.writeHead(200, { 'Content-Type': 'application/json' });\n    res.end(JSON.stringify({ ok: true }));\n    return;\n  }\n\n  // Handle all other requests\n  res.writeHead(404, { 'Content-Type': 'text/plain' });\n  res.end('Not Found');\n}\n\n// Create server and listen on port 3000\nconst server = http.createServer(requestHandler);\nserver.listen(3000, () => {\n  console.log('Server is running on http://localhost:3000');\n});"
    },
    {
      "path": "data/todos.json",
      "content": "[]"
    }
  ],
  "notes": "This patch includes the necessary changes to handle requests and manage TODO items. The server now reads from and writes to a `todos.json` file in the `data` directory."
}