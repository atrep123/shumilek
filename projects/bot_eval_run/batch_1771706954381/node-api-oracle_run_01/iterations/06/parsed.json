{
  "files": [
    {
      "path": "src/server.js",
      "content": "// Import necessary modules\nconst http = require('http');\nconst fs = require('fs');\nconst path = require('path');\n\n// Function to read data from a file\nfunction readFile(filePath) {\n  return new Promise((resolve, reject) => {\n    fs.readFile(filePath, 'utf8', (err, data) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(data);\n      }\n    });\n  });\n}\n\n// Function to write data to a file\nfunction writeFile(filePath, data) {\n  return new Promise((resolve, reject) => {\n    fs.writeFile(filePath, data, 'utf8', (err) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\n// Request handler function\nasync function requestHandler(req, res) {\n  const url = new URL(req.url, `http://${req.headers.host}`);\n  const method = req.method;\n\n  try {\n    if (url.pathname === '/health' && method === 'GET') {\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ status: 'healthy' }));\n    } else if (url.pathname === '/todos' && method === 'GET') {\n      const data = await readFile('data/todos.json');\n      const todos = JSON.parse(data);\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true, todos }));\n    } else if (url.pathname === '/todos' && method === 'POST') {\n      let body = '';\n      req.on('data', chunk => {\n        body += chunk.toString();\n      });\n      req.on('end', async () => {\n        const newTodo = JSON.parse(body);\n        newTodo.id = Date.now().toString();\n        newTodo.createdAt = new Date().toISOString();\n        newTodo.done = false;\n\n        let data = await readFile('data/todos.json');\n        let todos = JSON.parse(data);\n        todos.push(newTodo);\n        await writeFile('data/todos.json', JSON.stringify(todos, null, 2));\n\n        res.writeHead(201, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true, todo: newTodo }));\n      });\n    } else if (url.pathname.startsWith('/todos/') && method === 'GET') {\n      const id = url.pathname.split('/')[2];\n\n      let data = await readFile('data/todos.json');\n      let todos = JSON.parse(data);\n      const todo = todos.find(t => t.id === id);\n\n      if (todo) {\n        res.writeHead(200, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true, todo }));\n      } else {\n        res.writeHead(404, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'TODO item not found' }));\n      }\n    } else if (url.pathname.startsWith('/todos/') && method === 'PATCH') {\n      let body = '';\n      req.on('data', chunk => {\n        body += chunk.toString();\n      });\n      req.on('end', async () => {\n        const update = JSON.parse(body);\n        const id = url.pathname.split('/')[2];\n\n        let data = await readFile('data/todos.json');\n        let todos = JSON.parse(data);\n        const todoIndex = todos.findIndex(t => t.id === id);\n\n        if (todoIndex !== -1) {\n          todos[todoIndex].done = update.done;\n          if (update.done) {\n            todos[todoIndex].doneAt = new Date().toISOString();\n          }\n          await writeFile('data/todos.json', JSON.stringify(todos, null, 2));\n\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo: todos[todoIndex] }));\n        } else {\n          res.writeHead(404, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'TODO item not found' }));\n        }\n      });\n    } else if (url.pathname.startsWith('/todos/') && method === 'DELETE') {\n      const id = url.pathname.split('/')[2];\n\n      let data = await readFile('data/todos.json');\n      let todos = JSON.parse(data);\n      todos = todos.filter(t => t.id !== id);\n      await writeFile('data/todos.json', JSON.stringify(todos, null, 2));\n\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true }));\n    } else {\n      res.writeHead(404, { 'Content-Type': 'text/plain' });\n      res.end('Not Found');\n    }\n  } catch (err) {\n    console.error(err);\n    res.writeHead(500, { 'Content-Type': 'application/json' });\n    res.end(JSON.stringify({ ok: false, error: 'Internal Server Error' }));\n  }\n}\n\n// Create server and listen on port 3000\nconst server = http.createServer(requestHandler);\nserver.listen(3000, () => {\n  console.log('Server is running on http://localhost:3000');\n});"
    },
    {
      "path": "data/todos.json",
      "content": "[]"
    }
  ]
}