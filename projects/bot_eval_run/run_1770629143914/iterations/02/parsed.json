{
  "mode": "patch",
  "files": [
    {
      "path": "src/server.js",
      "content": "const http = require('http');\nconst fs = require('fs');\nconst crypto = require('crypto');\n\nfunction createServer({ dataPath }) {\n  let todos = [];\n\n  function loadData() {\n    try {\n      const data = JSON.parse(fs.readFileSync(dataPath, 'utf8'));\n      if (Array.isArray(data.todos)) {\n        todos = data.todos;\n      }\n    } catch (e) {}\n  }\n\n  function saveData() {\n    fs.writeFileSync(dataPath, JSON.stringify({ todos }, null, 2), 'utf8');\n  }\n\n  loadData();\n\n  const server = http.createServer((req, res) => {\n    let body = '';\n    req.on('data', chunk => (body += chunk));\n    req.on('end', () => {\n      try {\n        if (req.method === 'GET' && req.url === '/health') {\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true }));\n        } else if (req.method === 'GET' && req.url === '/openapi.json') {\n          fs.readFile('openapi.json', 'utf8', (err, data) => {\n            if (err) {\n              res.writeHead(500, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: false, error: 'Internal Server Error' }));\n            } else {\n              res.writeHead(200, { 'Content-Type': 'application/json' });\n              res.end(data);\n            }\n          });\n        } else if (req.method === 'GET' && req.url.startsWith('/todos')) {\n          const id = req.url.split('/')[2];\n          if (id) {\n            const todo = todos.find(t => t.id === id);\n            if (todo) {\n              res.writeHead(200, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: true, todo }));\n            } else {\n              res.writeHead(404, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n            }\n          } else {\n            res.writeHead(200, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: true, todos }));\n          }\n        } else if (req.method === 'POST' && req.url === '/todos') {\n          const data = JSON.parse(body);\n          if (!data.title) {\n            res.writeHead(400, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: false, error: 'Title is required' }));\n            return;\n          }\n          const newTodo = {\n            id: crypto.randomUUID(),\n            title: data.title,\n            done: false,\n            createdAt: new Date().toISOString()\n          };\n          todos.push(newTodo);\n          saveData();\n          res.writeHead(201, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo: newTodo }));\n        } else if (req.method === 'PATCH' && req.url.startsWith('/todos')) {\n          const id = req.url.split('/')[2];\n          const data = JSON.parse(body);\n          const todoIndex = todos.findIndex(t => t.id === id);\n          if (todoIndex !== -1) {\n            const todo = todos[todoIndex];\n            if (data.done !== undefined) {\n              todo.done = Boolean(data.done);\n              if (todo.done && !todo.doneAt) {\n                todo.doneAt = new Date().toISOString();\n              }\n            }\n            saveData();\n            res.writeHead(200, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: true, todo }));\n          } else {\n            res.writeHead(404, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n          }\n        } else if (req.method === 'DELETE' && req.url.startsWith('/todos')) {\n          const id = req.url.split('/')[2];\n          const todoIndex = todos.findIndex(t => t.id === id);\n          if (todoIndex !== -1) {\n            todos.splice(todoIndex, 1);\n            saveData();\n            res.writeHead(200, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: true }));\n          } else {\n            res.writeHead(404, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n          }\n        } else {\n          res.writeHead(404, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Not Found' }));\n        }\n      } catch (e) {\n        res.writeHead(500, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'Internal Server Error' }));\n      }\n    });\n  });\n\n  return server;\n}\n\nmodule.exports = { createServer };\n"
    }
  ],
  "notes": "Fixed unterminated string issue in src/server.js."
}