{
  "mode": "full",
  "files": [
    {
      "path": "README.md",
      "content": "# Simple TODO REST API\nThis project provides a simple REST API for managing TODO items using Node.js built-in modules.\n"
    },
    {
      "path": "package.json",
      "content": "{\n  \"name\": \"todo-api\",\n  \"version\": \"1.0.0\",\n  \"type\": \"commonjs\",\n  \"main\": \"src/server.js\"\n}\n"
    },
    {
      "path": "openapi.json",
      "content": "{\n  \"openapi\": \"3.0.0\",\n  \"info\": {\n    \"title\": \"TODO API\",\n    \"version\": \"1.0.0\"\n  },\n  \"paths\": {\n    \"/health\": {\n      \"get\": {\n        \"summary\": \"Check server health\",\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Server is healthy\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {\n                  \"type\": \"object\",\n                  \"properties\": {\n                    \"ok\": {\n                      \"type\": \"boolean\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/openapi.json\": {\n      \"get\": {\n        \"summary\": \"Get OpenAPI specification\",\n        \"responses\": {\n          \"200\": {\n            \"description\": \"OpenAPI specification\",\n            \"content\": {\n              \"application/json\": {}\n            }\n          }\n        }\n      }\n    },\n    \"/todos\": {\n      \"get\": {\n        \"summary\": \"Get all TODO items\",\n        \"responses\": {\n          \"200\": {\n            \"description\": \"List of TODO items\",\n            \"content\": {\n              \"application/json\": {}\n            }\n          }\n        }\n      },\n      \"post\": {\n        \"summary\": \"Create a new TODO item\",\n        \"requestBody\": {\n          \"required\": true,\n          \"content\": {\n            \"application/json\": {}\n          }\n        },\n        \"responses\": {\n          \"201\": {\n            \"description\": \"Created TODO item\",\n            \"content\": {\n              \"application/json\": {}\n            }\n          }\n        }\n      }\n    },\n    \"/todos/{id}\": {\n      \"get\": {\n        \"summary\": \"Get a TODO item by ID\",\n        \"parameters\": [{\n          \"name\": \"id\",\n          \"in\": \"path\",\n          \"required\": true,\n          \"schema\": {\n            \"type\": \"string\"\n          }\n        }],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"TODO item found\",\n            \"content\": {\n              \"application/json\": {}\n            }\n          },\n          \"404\": {\n            \"description\": \"TODO item not found\",\n            \"content\": {\n              \"application/json\": {}\n            }\n          }\n        }\n      },\n      \"patch\": {\n        \"summary\": \"Update a TODO item\",\n        \"parameters\": [{\n          \"name\": \"id\",\n          \"in\": \"path\",\n          \"required\": true,\n          \"schema\": {\n            \"type\": \"string\"\n          }\n        }],\n        \"requestBody\": {\n          \"required\": true,\n          \"content\": {\n            \"application/json\": {}\n          }\n        },\n        \"responses\": {\n          \"200\": {\n            \"description\": \"TODO item updated\",\n            \"content\": {\n              \"application/json\": {}\n            }\n          }\n        }\n      },\n      \"delete\": {\n        \"summary\": \"Delete a TODO item\",\n        \"parameters\": [{\n          \"name\": \"id\",\n          \"in\": \"path\",\n          \"required\": true,\n          \"schema\": {\n            \"type\": \"string\"\n          }\n        }],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"TODO item deleted\",\n            \"content\": {\n              \"application/json\": {}\n            }\n          }\n        }\n      }\n    }\n  }\n}\n"
    },
    {
      "path": "src/server.js",
      "content": "\"use strict\";\n\nconst http = require('http');\nconst fs = require('fs');\nconst path = require('path');\nconst crypto = require('crypto');\nconst url = require('url');\nconst util = require('util');\n\nconst readFile = util.promisify(fs.readFile);\nconst writeFile = util.promisify(fs.writeFile);\n\nfunction createServer({ dataPath }) {\n  let todos = [];\n\n  async function loadTodos() {\n    try {\n      const data = await readFile(dataPath, 'utf8');\n      const parsedData = JSON.parse(data);\n      if (Array.isArray(parsedData.todos)) {\n        todos = parsedData.todos;\n      }\n    } catch (err) {\n      if (err.code !== 'ENOENT') {\n        throw err;\n      }\n    }\n  }\n\n  async function saveTodos() {\n    await writeFile(dataPath, JSON.stringify({ todos }, null, 2), 'utf8');\n  }\n\n  loadTodos().catch(err => console.error('Failed to load todos:', err));\n\n  const server = http.createServer(async (req, res) => {\n    const parsedUrl = url.parse(req.url, true);\n    const pathname = parsedUrl.pathname;\n    let body = '';\n\n    req.on('data', chunk => {\n      body += chunk.toString();\n    });\n\n    req.on('end', async () => {\n      try {\n        switch (pathname) {\n          case '/health':\n            res.writeHead(200, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: true }));\n            break;\n\n          case '/openapi.json':\n            const openApiPath = path.join(__dirname, '..', 'openapi.json');\n            const openApiSpec = await readFile(openApiPath);\n            res.writeHead(200, { 'Content-Type': 'application/json' });\n            res.end(openApiSpec);\n            break;\n\n          case '/todos':\n            if (req.method === 'GET') {\n              res.writeHead(200, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: true, todos }));\n            } else if (req.method === 'POST') {\n              const data = JSON.parse(body);\n              if (!data.title) {\n                res.writeHead(400, { 'Content-Type': 'application/json' });\n                res.end(JSON.stringify({ ok: false, error: 'Title is required' }));\n                return;\n              }\n\n              const newTodo = {\n                id: crypto.randomUUID(),\n                title: data.title,\n                done: false,\n                createdAt: new Date().toISOString()\n              };\n\n              todos.push(newTodo);\n              await saveTodos();\n\n              res.writeHead(201, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: true, todo: newTodo }));\n            }\n            break;\n\n          default:\n            if (pathname.startsWith('/todos/')) {\n              const id = pathname.split('/').pop();\n              const todoIndex = todos.findIndex(todo => todo.id === id);\n\n              if (todoIndex === -1) {\n                res.writeHead(404, { 'Content-Type': 'application/json' });\n                res.end(JSON.stringify({ ok: false, error: 'TODO not found' }));\n                return;\n              }\n\n              switch (req.method) {\n                case 'GET':\n                  res.writeHead(200, { 'Content-Type': 'application/json' });\n                  res.end(JSON.stringify({ ok: true, todo: todos[todoIndex] }));\n                  break;\n\n                case 'PATCH':\n                  const patchData = JSON.parse(body);\n                  if (patchData.done !== undefined) {\n                    todos[todoIndex].done = patchData.done;\n                    if (todos[todoIndex].done && !todos[todoIndex].doneAt) {\n                      todos[todoIndex].doneAt = new Date().toISOString();\n                    }\n\n                    await saveTodos();\n\n                    res.writeHead(200, { 'Content-Type': 'application/json' });\n                    res.end(JSON.stringify({ ok: true, todo: todos[todoIndex] }));\n                  }\n                  break;\n\n                case 'DELETE':\n                  todos.splice(todoIndex, 1);\n                  await saveTodos();\n\n                  res.writeHead(200, { 'Content-Type': 'application/json' });\n                  res.end(JSON.stringify({ ok: true }));\n                  break;\n              }\n            }\n        }\n      } catch (err) {\n        console.error(err);\n        res.writeHead(500, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'Internal server error' }));\n      }\n    });\n  });\n\n  return server;\n}\n\nmodule.exports = createServer;\n"
    }
  ],
  "notes": "This project includes a simple HTTP server that provides CRUD operations for TODO items. The server supports loading and saving TODO items to a JSON file specified by the `dataPath` parameter. It also includes an OpenAPI specification for API documentation."
}