{
  "mode": "patch",
  "files": [
    {
      "path": "src/server.js",
      "content": "\"use strict\";\n\nconst http = require('http');\nconst fs = require('fs');\nconst path = require('path');\nconst crypto = require('crypto');\nconst url = require('url');\nconst util = require('util');\n\nconst readFile = util.promisify(fs.readFile);\nconst writeFile = util.promisify(fs.writeFile);\n\nfunction createServer({ dataPath }) {\n  let todos = [];\n\n  async function loadTodos() {\n    try {\n      const data = await readFile(dataPath, 'utf8');\n      const parsedData = JSON.parse(data);\n      if (Array.isArray(parsedData.todos)) {\n        todos = parsedData.todos;\n      }\n    } catch (err) {\n      if (err.code !== 'ENOENT') {\n        throw err;\n      }\n    }\n  }\n\n  async function saveTodos() {\n    await writeFile(dataPath, JSON.stringify({ todos }, null, 2), 'utf8');\n  }\n\n  loadTodos().catch(err => console.error('Failed to load todos:', err));\n\n  const server = http.createServer(async (req, res) => {\n    const parsedUrl = url.parse(req.url, true);\n    const pathname = parsedUrl.pathname;\n    let body = '';\n\n    req.on('data', chunk => {\n      body += chunk.toString();\n    });\n\n    req.on('end', async () => {\n      try {\n        switch (pathname) {\n          case '/health':\n            res.writeHead(200, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: true }));\n            break;\n\n          case '/openapi.json':\n            const openApiPath = path.join(__dirname, '..', 'openapi.json');\n            const openApiSpec = await readFile(openApiPath);\n            res.writeHead(200, { 'Content-Type': 'application/json' });\n            res.end(openApiSpec);\n            break;\n\n          case '/todos':\n            if (req.method === 'GET') {\n              res.writeHead(200, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: true, todos }));\n            } else if (req.method === 'POST') {\n              const data = JSON.parse(body);\n              if (!data.title) {\n                res.writeHead(400, { 'Content-Type': 'application/json' });\n                res.end(JSON.stringify({ ok: false, error: 'Title is required' }));\n                return;\n              }\n\n              const newTodo = {\n                id: crypto.randomUUID(),\n                title: data.title,\n                done: false,\n                createdAt: new Date().toISOString()\n              };\n\n              todos.push(newTodo);\n              await saveTodos();\n\n              res.writeHead(201, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: true, todo: newTodo }));\n            }\n            break;\n\n          default:\n            if (pathname.startsWith('/todos/')) {\n              const id = pathname.split('/').pop();\n              const todoIndex = todos.findIndex(todo => todo.id === id);\n\n              if (todoIndex === -1) {\n                res.writeHead(404, { 'Content-Type': 'application/json' });\n                res.end(JSON.stringify({ ok: false, error: 'TODO not found' }));\n                return;\n              }\n\n              switch (req.method) {\n                case 'GET':\n                  res.writeHead(200, { 'Content-Type': 'application/json' });\n                  res.end(JSON.stringify({ ok: true, todo: todos[todoIndex] }));\n                  break;\n\n                case 'PATCH':\n                  const patchData = JSON.parse(body);\n                  if (patchData.done !== undefined) {\n                    todos[todoIndex].done = patchData.done;\n                    if (todos[todoIndex].done && !todos[todoIndex].doneAt) {\n                      todos[todoIndex].doneAt = new Date().toISOString();\n                    }\n\n                    await saveTodos();\n\n                    res.writeHead(200, { 'Content-Type': 'application/json' });\n                    res.end(JSON.stringify({ ok: true, todo: todos[todoIndex] }));\n                  }\n                  break;\n\n                case 'DELETE':\n                  todos.splice(todoIndex, 1);\n                  await saveTodos();\n\n                  res.writeHead(200, { 'Content-Type': 'application/json' });\n                  res.end(JSON.stringify({ ok: true }));\n                  break;\n              }\n            }\n        }\n      } catch (err) {\n        console.error(err);\n        res.writeHead(500, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'Internal server error' }));\n      }\n    });\n  });\n\n  return server;\n}\n\nmodule.exports = createServer;"
    }
  ],
  "notes": "No changes were actually needed in the src/server.js file as it already correctly exports the `createServer` function. However, I included the full content to confirm that the file is correct."
}