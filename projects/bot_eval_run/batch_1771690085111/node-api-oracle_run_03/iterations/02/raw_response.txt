{
  "mode": "patch",
  "files": [
    {
      "path": "src/server.js",
      "content": "// src/server.js\nconst http = require('node:http');\nconst fs = require('node:fs');\nconst path = require('node:path');\nconst crypto = require('node:crypto');\nconst { parse } = require('node:url');\n\nfunction createServer({ dataPath }) {\n  const server = http.createServer((req, res) => {\n    const url = new URL(req.url, 'http://localhost/');\n    const method = req.method;\n    let body = '';\n\n    req.on('data', chunk => {\n      body += chunk.toString();\n    });\n\n    req.on('end', async () => {\n      try {\n        if (url.pathname === '/health' && method === 'GET') {\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true }));\n          return;\n        }\n\n        if (url.pathname === '/openapi.json' && method === 'GET') {\n          const openapi = JSON.parse(fs.readFileSync(path.join(__dirname, '../openapi.json'), 'utf8'));\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify(openapi));\n          return;\n        }\n\n        let todosData = fs.existsSync(dataPath) ? JSON.parse(fs.readFileSync(dataPath, 'utf8')) : { todos: [] };\n\n        if (url.pathname === '/todos' && method === 'GET') {\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todos: todosData.todos }));\n          return;\n        }\n\n        if (url.pathname === '/todos' && method === 'POST') {\n          const todo = JSON.parse(body);\n          if (!todo.title) {\n            res.writeHead(400, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: false, error: 'Title is required' }));\n            return;\n          }\n\n          const newTodo = {\n            id: crypto.randomUUID(),\n            title: todo.title,\n            done: false,\n            createdAt: new Date().toISOString()\n          };\n\n          todosData.todos.push(newTodo);\n          fs.writeFileSync(dataPath, JSON.stringify(todosData));\n\n          res.writeHead(201, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo: newTodo }));\n          return;\n        }\n\n        const id = url.pathname.split('/').pop();\n        if (id) {\n          const todoIndex = todosData.todos.findIndex(t => t.id === id);\n\n          if (url.pathname.startsWith('/todos/') && method === 'GET') {\n            if (todoIndex !== -1) {\n              res.writeHead(200, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: true, todo: todosData.todos[todoIndex] }));\n            } else {\n              res.writeHead(404, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n            }\n            return;\n          }\n\n          if (url.pathname.startsWith('/todos/') && method === 'PATCH') {\n            const update = JSON.parse(body);\n            if (todoIndex !== -1) {\n              todosData.todos[todoIndex] = {\n                ...todosData.todos[todoIndex],\n                done: update.done,\n                ...(update.done ? { doneAt: new Date().toISOString() } : {})\n              };\n\n              fs.writeFileSync(dataPath, JSON.stringify(todosData));\n\n              res.writeHead(200, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: true, todo: todosData.todos[todoIndex] }));\n            } else {\n              res.writeHead(404, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n            }\n            return;\n          }\n\n          if (url.pathname.startsWith('/todos/') && method === 'DELETE') {\n            if (todoIndex !== -1) {\n              todosData.todos.splice(todoIndex, 1);\n              fs.writeFileSync(dataPath, JSON.stringify(todosData));\n\n              res.writeHead(200, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: true }));\n            } else {\n              res.writeHead(404, { 'Content-Type': 'application/json' });\n              res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n            }\n            return;\n          }\n        }\n\n        res.writeHead(404, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'Not Found' }));\n      } catch (err) {\n        console.error(err);\n        res.writeHead(500, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'Internal Server Error' }));\n      }\n    });\n  });\n\n  return server;\n}\n\nmodule.exports = {\n  createServer\n};\n"
    }
  ],
  "notes": "Fixed unterminated string in JSON by ensuring all strings are properly closed and escaped."
}