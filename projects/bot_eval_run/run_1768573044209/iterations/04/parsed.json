{
  "mode": "patch",
  "files": [
    {
      "path": "src/server.js",
      "content": "\"use strict\";\n\nconst http = require('http');\nconst fs = require('fs');\nconst path = require('path');\nconst url = require('url');\nconst crypto = require('crypto');\n\nfunction loadData(dataPath) {\n  if (fs.existsSync(dataPath)) {\n    const data = fs.readFileSync(dataPath, 'utf8');\n    return JSON.parse(data);\n  }\n  return { todos: [] };\n}\n\nfunction saveData(dataPath, data) {\n  fs.writeFileSync(dataPath, JSON.stringify(data), 'utf8');\n}\n\nconst createServer = ({ dataPath }) => {\n  const db = loadData(dataPath);\n\n  const findTodo = (id) => db.todos.find(todo => todo.id === id);\n\n  const removeTodo = (id) => {\n    const index = db.todos.findIndex(todo => todo.id === id);\n    if (index !== -1) {\n      db.todos.splice(index, 1);\n      saveData(dataPath, db);\n      return true;\n    }\n    return false;\n  };\n\n  const updateTodo = (id, changes) => {\n    const todo = findTodo(id);\n    if (todo) {\n      Object.assign(todo, changes);\n      saveData(dataPath, db);\n      return todo;\n    }\n    return null;\n  };\n\n  const server = http.createServer((req, res) => {\n    const parsedUrl = url.parse(req.url, true);\n    const method = req.method.toUpperCase();\n    const pathname = parsedUrl.pathname;\n    let id = pathname.split('/')[2];\n\n    if (pathname === '/health' && method === 'GET') {\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true }));\n      return;\n    }\n\n    if (pathname === '/openapi.json' && method === 'GET') {\n      const openApiSpec = fs.readFileSync(path.join(__dirname, '../openapi.json'), 'utf8');\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(openApiSpec);\n      return;\n    }\n\n    if (pathname === '/todos' && method === 'GET') {\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true, todos: db.todos }));\n      return;\n    }\n\n    if (pathname === '/todos' && method === 'POST') {\n      let body = '';\n      req.on('data', chunk => {\n        body += chunk.toString();\n      });\n      req.on('end', () => {\n        try {\n          const { title } = JSON.parse(body);\n          if (!title) {\n            res.writeHead(400, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: false, error: 'Title is required' }));\n            return;\n          }\n          const newTodo = {\n            id: crypto.randomUUID(),\n            title,\n            done: false,\n            createdAt: new Date().toISOString()\n          };\n          db.todos.push(newTodo);\n          saveData(dataPath, db);\n          res.writeHead(201, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo: newTodo }));\n        } catch (e) {\n          res.writeHead(400, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Invalid JSON body' }));\n        }\n      });\n      return;\n    }\n\n    if (pathname.startsWith('/todos/') && method === 'GET') {\n      const todo = findTodo(id);\n      if (!todo) {\n        res.writeHead(404, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'TODO not found' }));\n        return;\n      }\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true, todo }));\n      return;\n    }\n\n    if (pathname.startsWith('/todos/') && method === 'PATCH') {\n      let body = '';\n      req.on('data', chunk => {\n        body += chunk.toString();\n      });\n      req.on('end', () => {\n        try {\n          const changes = JSON.parse(body);\n          if (changes.done === undefined) {\n            res.writeHead(400, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: false, error: 'Done status is required' }));\n            return;\n          }\n          const todo = updateTodo(id, changes);\n          if (!todo) {\n            res.writeHead(404, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: false, error: 'TODO not found' }));\n            return;\n          }\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo }));\n        } catch (e) {\n          res.writeHead(400, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Invalid JSON body' }));\n        }\n      });\n      return;\n    }\n\n    if (pathname.startsWith('/todos/') && method === 'DELETE') {\n      const removed = removeTodo(id);\n      if (!removed) {\n        res.writeHead(404, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'TODO not found' }));\n        return;\n      }\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true }));\n      return;\n    }\n\n    res.writeHead(404, { 'Content-Type': 'application/json' });\n    res.end(JSON.stringify({ ok: false, error: 'Not Found' }));\n  });\n\n  return server;\n};\n\nmodule.exports = { createServer };"
    }
  ],
  "notes": "Změnil jsem export modulu tak, aby byl kompatibilní s importem v testech."
}