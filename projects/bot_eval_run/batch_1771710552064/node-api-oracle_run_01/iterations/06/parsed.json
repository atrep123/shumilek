{
  "files": [
    {
      "path": "src/server.js",
      "content": "// src/server.js\nconst http = require('node:http');\nconst fs = require('node:fs');\nconst path = require('node:path');\nconst crypto = require('node:crypto');\nconst { parse } = require('node:url');\n\nfunction createServer({ dataPath }) {\n  const server = http.createServer((req, res) => {\n    const url = new URL(req.url, `http://${req.headers.host}`);\n    const method = req.method;\n\n    if (url.pathname === '/health' && method === 'GET') {\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true }));\n      return;\n    }\n\n    if (url.pathname === '/openapi.json' && method === 'GET') {\n      const openApiSpec = JSON.parse(fs.readFileSync(path.join(__dirname, '../openapi.json'), 'utf8'));\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify(openApiSpec));\n      return;\n    }\n\n    if (url.pathname === '/todos' && method === 'GET') {\n      let todos = [];\n      if (fs.existsSync(dataPath)) {\n        todos = JSON.parse(fs.readFileSync(dataPath, 'utf8')).todos || [];\n      }\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true, todos }));\n      return;\n    }\n\n    if (url.pathname === '/todos' && method === 'POST') {\n      let body = '';\n      req.on('data', chunk => {\n        body += chunk.toString();\n      });\n      req.on('end', () => {\n        const { title } = JSON.parse(body);\n        if (!title) {\n          res.writeHead(400, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Title is required' }));\n          return;\n        }\n        const todo = {\n          id: crypto.randomUUID(),\n          title,\n          done: false,\n          createdAt: new Date().toISOString()\n        };\n        let todos = [];\n        if (fs.existsSync(dataPath)) {\n          todos = JSON.parse(fs.readFileSync(dataPath, 'utf8')).todos || [];\n        }\n        todos.push(todo);\n        fs.writeFileSync(dataPath, JSON.stringify({ todos }, null, 2));\n        res.writeHead(201, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true, todo }));\n      });\n      return;\n    }\n\n    if (url.pathname.startsWith('/todos/') && method === 'GET') {\n      const id = url.pathname.split('/')[2];\n      let todos = [];\n      if (fs.existsSync(dataPath)) {\n        todos = JSON.parse(fs.readFileSync(dataPath, 'utf8')).todos || [];\n      }\n      const todo = todos.find(t => t.id === id);\n      if (!todo) {\n        res.writeHead(404, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n        return;\n      }\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true, todo }));\n      return;\n    }\n\n    if (url.pathname.startsWith('/todos/') && method === 'PATCH') {\n      const id = url.pathname.split('/')[2];\n      let body = '';\n      req.on('data', chunk => {\n        body += chunk.toString();\n      });\n      req.on('end', () => {\n        const { done } = JSON.parse(body);\n        if (done === undefined) {\n          res.writeHead(400, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Done status is required' }));\n          return;\n        }\n        let todos = [];\n        if (fs.existsSync(dataPath)) {\n          todos = JSON.parse(fs.readFileSync(dataPath, 'utf8')).todos || [];\n        }\n        const todoIndex = todos.findIndex(t => t.id === id);\n        if (todoIndex === -1) {\n          res.writeHead(404, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n          return;\n        }\n        const todo = todos[todoIndex];\n        todo.done = done;\n        if (done) {\n          todo.doneAt = new Date().toISOString();\n        }\n        fs.writeFileSync(dataPath, JSON.stringify({ todos }, null, 2));\n        res.writeHead(200, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true, todo }));\n      });\n      return;\n    }\n\n    if (url.pathname.startsWith('/todos/') && method === 'DELETE') {\n      const id = url.pathname.split('/')[2];\n      let todos = [];\n      if (fs.existsSync(dataPath)) {\n        todos = JSON.parse(fs.readFileSync(dataPath, 'utf8')).todos || [];\n      }\n      const todoIndex = todos.findIndex(t => t.id === id);\n      if (todoIndex === -1) {\n        res.writeHead(404, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n        return;\n      }\n      todos.splice(todoIndex, 1);\n      fs.writeFileSync(dataPath, JSON.stringify({ todos }, null, 2));\n      res.writeHead(204); // No content\n      res.end();\n      return;\n    }\n\n    res.writeHead(404, { 'Content-Type': 'application/json' });\n    res.end(JSON.stringify({ ok: false, error: 'Not found' }));\n  });\n\n  return server;\n}\n\nmodule.exports = { createServer };"
    }
  ],
  "notes": "Fixed the DELETE method to return a 204 status code and corrected the PATCH request handling."
}