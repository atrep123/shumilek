{
  "mode": "patch",
  "files": [
    {
      "path": "src/server.js",
      "content": "module.exports.createServer = ({ dataPath }) => {\n  const todos = [];\n\n  if (fs.existsSync(dataPath)) {\n    const fileData = JSON.parse(fs.readFileSync(dataPath, 'utf8'));\n    todos.push(...fileData.todos);\n  }\n\n  return http.createServer((req, res) => {\n    const parsedUrl = url.parse(req.url, true);\n    if (parsedUrl.pathname === '/health') {\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true }));\n    } else if (parsedUrl.pathname === '/openapi.json') {\n      const openApiSpec = {\n        openapi: '3.0.0',\n        paths: { '/todos': {} }\n      };\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify(openApiSpec));\n    } else if (parsedUrl.pathname === '/todos') {\n      if (req.method === 'GET') {\n        res.writeHead(200, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true, todos }));\n      } else if (req.method === 'POST') {\n        let body = '';\n        req.on('data', chunk => { body += chunk.toString(); });\n        req.on('end', () => {\n          const todoData = JSON.parse(body);\n          const newTodo = {\n            id: crypto.randomUUID(),\n            title: todoData.title,\n            done: false,\n            createdAt: new Date().toISOString()\n          };\n          todos.push(newTodo);\n          fs.writeFileSync(dataPath, JSON.stringify({ todos }));\n          res.writeHead(201, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo: newTodo }));\n        });\n      }\n    } else if (parsedUrl.pathname.match(/^/todos/[a-f0-9]+$/)) {\n      const id = parsedUrl.pathname.split('/').pop();\n      if (req.method === 'GET') {\n        const todo = todos.find(t => t.id === id);\n        if (todo) {\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo }));\n        } else {\n          res.writeHead(404, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n        }\n      } else if (req.method === 'PATCH') {\n        let body = '';\n        req.on('data', chunk => { body += chunk.toString(); });\n        req.on('end', () => {\n          const updates = JSON.parse(body);\n          const todoIndex = todos.findIndex(t => t.id === id);\n          if (todoIndex !== -1) {\n            todos[todoIndex].done = updates.done;\n            fs.writeFileSync(dataPath, JSON.stringify({ todos }));\n            res.writeHead(200, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: true, todo: todos[todoIndex] }));\n          } else {\n            res.writeHead(404, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n          }\n        });\n      } else if (req.method === 'DELETE') {\n        const todoIndex = todos.findIndex(t => t.id === id);\n        if (todoIndex !== -1) {\n          todos.splice(todoIndex, 1);\n          fs.writeFileSync(dataPath, JSON.stringify({ todos }));\n          res.writeHead(204, { 'Content-Type': 'application/json' });\n          res.end();\n        } else {\n          res.writeHead(404, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n        }\n      }\n    } else {\n      res.writeHead(404, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: false, error: 'Not Found' }));\n    }\n  }).listen(8080);\n};\n"
    }
  ]
}