{"mode":"full","files":[{"path":"README.md","content":"# TODO API\n\nTento projekt implementuje REST API pro správu TODO položek s možností persistenci dat do souboru.\n\n## Endpoints:\n- **GET /health** - Zdravotní stav serveru.\n- **GET /openapi.json** - OpenAPI specifikace API.\n- **GET /todos** - Seznam všech TODO položek.\n- **POST /todos** - Vytvořit novou TODO položku (vyžaduje JSON s polem `title`).\n- **GET /todos/:id** - Získat konkrétní TODO položku podle ID.\n- **PATCH /todos/:id** - Aktualizovat stav TODO položky (upravit JSON s polem `done`).\n- **DELETE /todos/:id** - Smazat TODO položku podle ID.\n\n## Instalace a spuštění:\n1. Nainstalujte závislosti: `npm install`\n2. Spusťte server: `node src/server.js`\n\n## Testování:\nPro testování API lze použít skripty uvedené v [tests/oracle.test.js](tests/oracle.test.js).\n"}, {"path":"package.json","content":"{\n  \"name\": \"todo-api\",\n  \"version\": \"1.0.0\",\n  \"type\": \"commonjs\"\n}\n"},{"path":"src/server.js","content":"const http = require('node:http');\nconst url = require('node:url');\nconst crypto = require('node:crypto');\nconst fs = require('node:fs');\nconst path = require('node:path');\n\nfunction createServer({ dataPath }) {\n  const todos = [];\n\n  function readTodos() {\n    if (fs.existsSync(dataPath)) {\n      return JSON.parse(fs.readFileSync(dataPath, 'utf8')).todos;\n    } else {\n      return [];\n    }\n  }\n\n  function writeTodos(newTodos) {\n    fs.writeFileSync(dataPath, JSON.stringify({ todos: newTodos }));\n  }\n\n  const server = http.createServer((req, res) => {\n    const parsedUrl = url.parse(req.url, true);\n    if (parsedUrl.pathname === '/health') {\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true }));\n    } else if (parsedUrl.pathname === '/openapi.json') {\n      const openApiSpec = {\n        openapi: '3.0.0',\n        paths: { '/todos': {} }\n      };\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify(openApiSpec));\n    } else if (parsedUrl.pathname === '/todos') {\n      if (req.method === 'GET') {\n        res.writeHead(200, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true, todos: readTodos() }));\n      } else if (req.method === 'POST') {\n        let body = '';\n        req.on('data', chunk => { body += chunk.toString(); });\n        req.on('end', () => {\n          const newTodo = JSON.parse(body);\n          newTodo.id = crypto.randomUUID();\n          newTodo.createdAt = new Date().toISOString();\n          todos.push(newTodo);\n          writeTodos(todos);\n          res.writeHead(201, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo: newTodo }));\n        });\n      } else {\n        res.writeHead(405, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'Method Not Allowed' }));\n      }\n    } else if (parsedUrl.pathname.startsWith('/todos/')) {\n      const todoId = parsedUrl.pathname.split('/')[2];\n      if (req.method === 'GET') {\n        const todo = todos.find(t => t.id === todoId);\n        if (todo) {\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo }));\n        } else {\n          res.writeHead(404, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Todo Not Found' }));\n        }\n      } else if (req.method === 'PATCH') {\n        let body = '';\n        req.on('data', chunk => { body += chunk.toString(); });\n        req.on('end', () => {\n          const updatedFields = JSON.parse(body);\n          const index = todos.findIndex(t => t.id === todoId);\n          if (index !== -1) {\n            Object.assign(todos[index], updatedFields);\n            writeTodos(todos);\n            res.writeHead(200, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: true, todo: todos[index] }));\n          } else {\n            res.writeHead(404, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: false, error: 'Todo Not Found' }));\n          }\n        });\n      } else if (req.method === 'DELETE') {\n        const index = todos.findIndex(t => t.id === todoId);\n        if (index !== -1) {\n          todos.splice(index, 1);\n          writeTodos(todos);\n          res.writeHead(204, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true }));\n        } else {\n          res.writeHead(404, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Todo Not Found' }));\n        }\n      } else {\n        res.writeHead(405, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'Method Not Allowed' }));\n      }\n    } else {\n      res.writeHead(404, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: false, error: 'Not Found' }));\n    }\n  });\n\n  return server;\n}\n\nmodule.exports = createServer;\n"}, {"path":"tests/oracle.test.js","content":"const { test } = require('node:test');\nconst { readFileSync, writeFileSync } = require('node:fs');\nconst path = require('node:path');\nconst serverPath = path.join(__dirname, '..', 'src', 'server.js');\nconst createServer = require(serverPath);\n\ntest('TODO API', async (t) => {\n  const dataPath = path.join(__dirname, 'data.json');\n  if (!fs.existsSync(dataPath)) {\n    writeFileSync(dataPath, JSON.stringify({ todos: [] }));\n  }\n\n  const server = createServer({ dataPath });\n\ntest('GET /health', async (t) => {\n  const options = { method: 'GET' };\n  const req = await fetch('http://localhost:8080/health', options);\n  const res = await req.json();\n  t.equal(req.status, 200);\n  t.deepEqual(res, { ok: true });\n});\ntest('GET /openapi.json', async (t) => {\n  const options = { method: 'GET' };\n  const req = await fetch('http://localhost:8080/openapi.json', options);\n  const res = await req.json();\n  t.equal(req.status, 200);\n  t.deepEqual(res, {\n    openapi: '3.0.0',\n    paths: { '/todos': {} }\n  });\n});\ntest('GET /todos', async (t) => {\n  const options = { method: 'GET' };\n  const req = await fetch('http://localhost:8080/todos', options);\n  const res = await req.json();\n  t.equal(req.status, 200);\n  t.deepEqual(res, { ok: true, todos: [] });\n});\ntest('POST /todos', async (t) => {\n  const options = { method: 'POST', headers: { 'Content-Type': 'application/json' } };\n  const req = await fetch('http://localhost:8080/todos', {\n    ...options,\n    body: JSON.stringify({ title: 'Test Todo' })\n  });\n  const res = await req.json();\n  t.equal(req.status, 201);\n  t.deepEqual(res, { ok: true, todo: {\n    id: expect.any(String),\n    title: 'Test Todo',\n    createdAt: expect.any(String)\n  }});\n});\ntest('GET /todos/:id', async (t) => {\n  const options = { method: 'POST', headers: { 'Content-Type': 'application/json' } };\n  const createReq = await fetch('http://localhost:808