{
  "mode": "patch",
  "files": [
    {
      "path": "package.json",
      "content": "{\n  \"name\": \"node-api\",\n  \"version\": \"1.0.0\",\n  \"type\": \"commonjs\"\n}"
    },
    {
      "path": "src/server.js",
      "content": "const http = require('http');\nconst crypto = require('crypto');\nconst fs = require('fs');\nconst path = require('path');\n\nmodule.exports.createServer = ({ dataPath }) => {\n  const todos = [];\n\n  function saveTodos() {\n    fs.writeFileSync(dataPath, JSON.stringify({ todos }));\n  }\n\n  http.createServer((req, res) => {\n    if (req.method === 'GET' && req.url === '/health') {\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: true }));\n    } else if (req.method === 'GET' && req.url === '/openapi.json') {\n      const spec = {\n        openapi: '3.0.1',\n        info: { title: 'TODO API', version: '1.0.0' },\n        paths: {}\n      };\n      if (!fs.existsSync(dataPath)) fs.writeFileSync(dataPath, JSON.stringify({ todos: [] }));\n      spec.paths['/todos'] = { get: { responses: { '200': { description: 'List all todos', content: { 'application/json': {} } } } } };\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify(spec));\n    } else if (req.method === 'GET' && req.url.startsWith('/todos')) {\n      const id = req.url.split('/').pop();\n      const todo = todos.find(t => t.id === id);\n      if (!todo) {\n        res.writeHead(404, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n      } else {\n        res.writeHead(200, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true, todo }));\n      }\n    } else if (req.method === 'POST' && req.url === '/todos') {\n      let body = '';\n      req.on('data', chunk => { body += chunk.toString(); });\n      req.on('end', () => {\n        const data = JSON.parse(body);\n        if (!data.title) {\n          res.writeHead(400, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Title is required' }));\n        } else {\n          const todo = { id: crypto.randomUUID(), title: data.title, done: false, createdAt: new Date().toISOString() };\n          todos.push(todo);\n          saveTodos();\n          res.writeHead(201, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo }));\n        }\n      });\n    } else if (req.method === 'PATCH' && req.url.startsWith('/todos')) {\n      let body = '';\n      req.on('data', chunk => { body += chunk.toString(); });\n      req.on('end', () => {\n        const data = JSON.parse(body);\n        const id = req.url.split('/').pop();\n        const todoIndex = todos.findIndex(t => t.id === id);\n        if (todoIndex === -1) {\n          res.writeHead(404, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n        } else {\n          const todo = todos[todoIndex];\n          if (data.done !== undefined) todo.done = data.done;\n          if (data.done && !todo.doneAt) todo.doneAt = new Date().toISOString();\n          todos[todoIndex] = todo;\n          saveTodos();\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo }));\n        }\n      });\n    } else if (req.method === 'DELETE' && req.url.startsWith('/todos')) {\n      const id = req.url.split('/').pop();\n      const todoIndex = todos.findIndex(t => t.id === id);\n      if (todoIndex === -1) {\n        res.writeHead(404, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: false, error: 'Todo not found' }));\n      } else {\n        todos.splice(todoIndex, 1);\n        saveTodos();\n        res.writeHead(200, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true }));\n      }\n    } else {\n      res.writeHead(404, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ ok: false, error: 'Not found' }));\n    }\n  }).listen(3000);\n  console.log('Server running at http://localhost:3000');\n}"
    }
  ],
  "notes": "optional"
}