{
  "files": [
    {
      "path": "src/server.js",
      "content": "// Your server code here\nconst http = require('http');\nconst fs = require('fs');\nconst path = require('path');\n\nconst routes = require('./routes/todoRoutes');\n\nfunction createServer(dataPath) {\n  return http.createServer((req, res) => {\n    if (req.url === '/openapi.json' && req.method === 'GET') {\n      const openApiSpec = fs.readFileSync(path.join(__dirname, '../openapi.json'), 'utf8');\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(openApiSpec);\n    } else {\n      routes(req, res, dataPath);\n    }\n  });\n}\n\nmodule.exports = createServer;\n"
    },
    {
      "path": "src/routes/todoRoutes.js",
      "content": "const fs = require('fs');\nconst path = require('path');\nconst uuid = require('uuid').v4;\n\nfunction todoRoutes(req, res, dataPath) {\n  const dbPath = path.join(dataPath, 'db.json');\n\n  if (!fs.existsSync(dbPath)) {\n    fs.writeFileSync(dbPath, JSON.stringify({ todos: [] }));\n  }\n\n  let data = JSON.parse(fs.readFileSync(dbPath, 'utf8'));\n\n  switch (req.url) {\n    case '/health':\n      if (req.method === 'GET') {\n        res.writeHead(200, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ status: 'ok' }));\n      }\n      break;\n\n    case '/todos':\n      if (req.method === 'GET') {\n        res.writeHead(200, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ ok: true, todos: data.todos }));\n      } else if (req.method === 'POST') {\n        let body = '';\n        req.on('data', chunk => {\n          body += chunk.toString();\n        });\n        req.on('end', () => {\n          const newTodo = JSON.parse(body);\n          newTodo.id = uuid();\n          newTodo.createdAt = new Date().toISOString();\n          data.todos.push(newTodo);\n          fs.writeFileSync(dbPath, JSON.stringify(data));\n          res.writeHead(201, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo: newTodo }));\n        });\n      }\n      break;\n\n    default:\n      if (req.url.startsWith('/todos/') && req.method === 'GET') {\n        const id = req.url.split('/')[2];\n        const todo = data.todos.find(t => t.id === id);\n        if (todo) {\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true, todo }));\n        } else {\n          res.writeHead(404, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'TODO item not found' }));\n        }\n      } else if (req.url.startsWith('/todos/') && req.method === 'PATCH') {\n        const id = req.url.split('/')[2];\n        let body = '';\n        req.on('data', chunk => {\n          body += chunk.toString();\n        });\n        req.on('end', () => {\n          const update = JSON.parse(body);\n          const todoIndex = data.todos.findIndex(t => t.id === id);\n          if (todoIndex !== -1) {\n            data.todos[todoIndex].done = update.done;\n            data.todos[todoIndex].doneAt = new Date().toISOString();\n            fs.writeFileSync(dbPath, JSON.stringify(data));\n            res.writeHead(200, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: true, todo: data.todos[todoIndex] }));\n          } else {\n            res.writeHead(404, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ ok: false, error: 'TODO item not found' }));\n          }\n        });\n      } else if (req.url.startsWith('/todos/') && req.method === 'DELETE') {\n        const id = req.url.split('/')[2];\n        const todoIndex = data.todos.findIndex(t => t.id === id);\n        if (todoIndex !== -1) {\n          data.todos.splice(todoIndex, 1);\n          fs.writeFileSync(dbPath, JSON.stringify(data));\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: true }));\n        } else {\n          res.writeHead(404, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ ok: false, error: 'TODO item not found' }));\n        }\n      }\n  }\n}\n\nmodule.exports = todoRoutes;\n"
    }
  ],
  "notes": "Updated src/server.js to export a function that creates the server and pass dataPath to routes. Updated src/routes/todoRoutes.js to handle data persistence using a JSON file."
}